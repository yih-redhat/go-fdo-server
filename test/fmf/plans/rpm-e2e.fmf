summary: FDO test plan
description: Fast smoke tests + comprehensive FDO protocol testing

discover:
    how: fmf
    filter: tag:rpm

provision:
    how: virtual
    memory: 2048MB
    disk: 10GB

prepare:
  - how: shell
    script: |
      rpm -q --whatprovides 'dnf-command(copr)' &> /dev/null || dnf install -y 'dnf-command(copr)'
      dnf copr list | grep 'fedora-iot/fedora-iot' || {
        . /etc/os-release
        if [ "${ID}" = "centos" ]; then
          dnf copr enable -y '@fedora-iot/fedora-iot' ${ID}-stream-${ID_VERSION}
        else
          dnf copr enable -y '@fedora-iot/fedora-iot'
        fi
      }
      # testing-farm-tag-repository is causing problems with builds see:
      #Â https://docs.testing-farm.io/Testing%20Farm/0.1/test-environment.html#disabling-tag-repository
      dnf install --disablerepo=testing-farm-tag-repository -y go-fdo-client
      dnf copr disable -y @fedora-iot/fedora-iot

  - how: install
    package:
      - golang
      - make
      - openssl
      - curl
      - git

execute:
    how: tmt
